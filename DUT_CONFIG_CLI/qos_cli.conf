#!/bin/bash

function qos_reset(){

cat <<-EOF > cmds/${test_function}_dut_config_restore.cmd
echo $password | sudo -S cp /etc/soce_design/factory_config/SWITCH/priorities.json /etc/soce_configs/current/SWITCH/priorities.json
soce_cli
priorities reload_configuration SWITCH
EOF
}

#-----------------------------------------------------------------------------------------------------------------------------------------
#  Test QoS.2  Handling Frame Priorities  PCP Based Weighted Round Robin Priority
#-----------------------------------------------------------------------------------------------------------------------------------------
# 2 QUEUES
function test_qos_2_1(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
raw_ip_conf write SWITCH:prior_port_selector 0
raw_ip_conf write SWITCH:prior_priority_mode_reg 4
raw_ip_conf write SWITCH:prior_port_selector 1
raw_ip_conf write SWITCH:prior_priority_mode_reg 4
raw_ip_conf write SWITCH:prior_port_selector 2
raw_ip_conf write SWITCH:prior_priority_mode_reg 2
raw_ip_conf write SWITCH:prior_protocol_priority_mapping_0_reg 0x1ffff
EOF
}

#-----------------------------------------------------------------------------------------------------------------------------------------
#  Test QoS.3  Protocol Based Priorities
#-----------------------------------------------------------------------------------------------------------------------------------------


function test_qos_3_1(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
echo $password | sudo -S cp ${test_function}.json /etc/soce_configs/current/SWITCH/priorities.json
soce_cli
priorities reload_configuration SWITCH
EOF
}

function test_qos_3_1_restore(){

    qos_reset
}

function test_qos_3_2(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
echo $password | sudo -S cp ${test_function}.json /etc/soce_configs/current/SWITCH/priorities.json
soce_cli
priorities reload_configuration SWITCH
EOF
}

function test_qos_3_2_restore(){

    qos_reset
}

#----------------------------------------------------------------------------------------------------
#  Test QoS.4  Handling Frame Priorities  DSCP Based Strict Priority Test Setup
#----------------------------------------------------------------------------------------------------

function test_qos_4_1(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
echo $password | sudo -S cp ${test_function}.json /etc/soce_configs/current/SWITCH/priorities.json
soce_cli
priorities reload_configuration SWITCH
EOF
}

function test_qos_4_1_restore(){

    qos_reset
}

function test_qos_4_2(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
echo $password | sudo -S cp ${test_function}.json /etc/soce_configs/current/SWITCH/priorities.json
soce_cli
priorities reload_configuration SWITCH
EOF
}

function test_qos_4_2_restore(){

    qos_reset
}

#----------------------------------------------------------------------------------------------------
# Test QoS.5  Handling Frame Priorities  PCP Based Priority Mapping
#----------------------------------------------------------------------------------------------------

function test_qos_5_1(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
echo $password | sudo -S cp ${test_function}.json /etc/soce_configs/current/SWITCH/priorities.json
soce_cli
priorities reload_configuration SWITCH
EOF
}

function test_qos_5_1_restore(){

    qos_reset
}

function test_qos_5_2(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
echo $password | sudo -S cp ${test_function}.json /etc/soce_configs/current/SWITCH/priorities.json
soce_cli
priorities reload_configuration SWITCH
EOF
}

function test_qos_5_2_restore(){

    qos_reset
}

#----------------------------------------------------------------------------------------------------
# Test QoS.6  Handling Frame Priorities  DSCP Based Priority Mapping
#----------------------------------------------------------------------------------------------------

function test_qos_6_1(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
echo $password | sudo -S cp ${test_function}.json /etc/soce_configs/current/SWITCH/priorities.json
soce_cli
priorities reload_configuration SWITCH
EOF
}

function test_qos_6_1_tsn_pcie(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
echo $password | sudo -S cp ${test_function}_${id_special}.json /etc/soce_configs/current/SWITCH/priorities.json
soce_cli
priorities reload_configuration SWITCH
EOF
}


function test_qos_6_1_restore(){

    qos_reset
}

function test_qos_6_2(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
echo $password | sudo -S cp ${test_function}.json /etc/soce_configs/current/SWITCH/priorities.json
soce_cli
priorities reload_configuration SWITCH
EOF
}

function test_qos_6_2_restore(){

    qos_reset
}

#----------------------------------------------------------------------------------------------------
# Test QoS.7  Handling Frame Priorities  Port Based Strict Priority
#----------------------------------------------------------------------------------------------------
# 2 QUEUES
function test_qos_7_1(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
raw_ip_conf write SWITCH:prior_port_selector 0
raw_ip_conf write SWITCH:prior_priority_mode_reg 1
raw_ip_conf write SWITCH:prior_port_selector 1
raw_ip_conf write SWITCH:prior_priority_mode_reg 1
raw_ip_conf write SWITCH:prior_port_queue_mapping 1
raw_ip_conf write SWITCH:prior_port_selector 2
raw_ip_conf write SWITCH:prior_priority_mode_reg 0
raw_ip_conf write SWITCH:prior_port_selector 3
raw_ip_conf write SWITCH:prior_priority_mode_reg 0
EOF
}
