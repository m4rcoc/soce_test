#!/bin/bash

function ntp_reset(){

cat <<-EOF > cmds/${test_function}_dut_config_restore.cmd
soce_cli
ntp set_server_conf 1 enabled 0.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 2 enabled 1.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 3 enabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 enabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 enabled 4.es.pool.ntp.org 64 1024 iburst none
ntp set_key_conf 1 disabled "" "" ""
ntp set_key_conf 2 disabled "" "" ""
ntp set_key_conf 3 disabled "" "" ""
ntp set_key_conf 4 disabled "" "" ""
ntp set_key_conf 5 disabled "" "" ""
ntp set_param trusted_keys ""
ntp set_broadcast_conf disabled 192.168.2.255 16 none
ntp set_manycast_conf disabled 224.0.1.1 none
ntp set_multicast_conf disabled 224.0.1.1 16 127 none
ntp restart
EOF

#ntp stop?
}

#-----------------------------------------------------------------------------------------------------------------------------------------
# Test NTP.1 – Synchronization to external servers
#-----------------------------------------------------------------------------------------------------------------------------------------

function test_ntp_1_1(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp restart
EOF
}

function test_ntp_1_1_restore(){
    ntp_reset
}



#-----------------------------------------------------------------------------------------------------------------------------------------
# Test NTP.2 – NTP broadcast
#-----------------------------------------------------------------------------------------------------------------------------------------

function test_ntp_2_1(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp restart
EOF
}

function test_ntp_2_1_restore(){
    ntp_reset
}


function test_ntp_2_2(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp restart
EOF
}

function test_ntp_2_2_restore(){
    ntp_reset
}

function test_ntp_2_3(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp restart
EOF
}

function test_ntp_2_3_restore(){
    ntp_reset
}

function test_ntp_2_4(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp restart
EOF
}

function test_ntp_2_4_restore(){
    ntp_reset
}

function test_ntp_2_5(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp restart
EOF
}

function test_ntp_2_5_restore(){
    ntp_reset
}


function test_ntp_2_6(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp restart
EOF
}

function test_ntp_2_6_restore(){
    ntp_reset
}

function test_ntp_2_7(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp restart
EOF
}

function test_ntp_2_7_restore(){
    ntp_reset
}

#-----------------------------------------------------------------------------------------------------------------------------------------
# Test NTP.4 – NTP multicast
#-----------------------------------------------------------------------------------------------------------------------------------------


#-----------------------------------------------------------------------------------------------------------------------------------------
# Test NTP.4 – NTP manycast
#-----------------------------------------------------------------------------------------------------------------------------------------


#-----------------------------------------------------------------------------------------------------------------------------------------
# Test NTP.5 – NTP servers with authentication (Symmetric/Private Key)
#-----------------------------------------------------------------------------------------------------------------------------------------

function test_ntp_5_1(){


cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_key_conf 1 enabled 1 MD5 "d4*.&x;4B[)olkU{Hsw4"
ntp set_key_conf 2 enabled 2 MD5 "^I>W\`/Doh~4R7G4A'0pK"
ntp set_key_conf 3 enabled 3 SHA1 9c5a706960ee3bf7bc4b10a7500886681131b554
ntp set_key_conf 4 enabled 4 SHA1 5b755b86e8c84ce46936c6c5698afa53253cdade
ntp set_param trusted_keys 1,2,3,4 
ntp set_server_conf 1 enabled 192.168.2.148 64 1024 iburst 1
ntp set_server_conf 2 enabled 192.168.2.245 64 1024 iburst 2
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp restart
EOF
}

function test_ntp_5_1_restore(){
    ntp_reset
}

#-----------------------------------------------------------------------------------------------------------------------------------------
# Test NTP.6 – NTP leap second handling
#-----------------------------------------------------------------------------------------------------------------------------------------

function test_ntp_6_1(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp import_leap_file test_leap_seconds.list
ntp restart
EOF
}

function test_ntp_6_1_restore(){
    ntp_reset
}

function test_ntp_6_2(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp import_leap_file real_leap_seconds.list
ntp restart
EOF
}

function test_ntp_6_2_restore(){
    ntp_reset
}


#-----------------------------------------------------------------------------------------------------------------------------------------
# Test NTP.7 – Test with 802.1AS
#-----------------------------------------------------------------------------------------------------------------------------------------

function test_ntp_7_1(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp import_leap_file test_leap_seconds.list
ntp restart
EOF
}

function test_ntp_7_1_restore(){
    ntp_reset
}

function test_ntp_7_2(){

cat <<-EOF > cmds/${test_function}_dut_config.cmd
soce_cli
time_date set 2021-01-01 00:00:00
ntp set_server_conf 1 enabled 192.168.2.245 64 1024 iburst none
ntp set_server_conf 2 enabled 192.168.2.148 64 1024 iburst none
ntp set_server_conf 3 disabled 2.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 4 disabled 3.es.pool.ntp.org 64 1024 iburst none
ntp set_server_conf 5 disabled 4.es.pool.ntp.org 64 1024 iburst none
ntp import_leap_file real_leap_seconds.list
ntp restart
EOF
}

function test_ntp_7_2_restore(){
    ntp_reset
}


