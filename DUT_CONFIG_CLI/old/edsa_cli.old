#!/bin/bash


function test_edsa_2_1(){

if ! which "/usr/bin/pip3" > /dev/null; then
	echo $password | sudo -S apt-get update
	printf "\nInstalling Python3 (pip3) on the DUT"
	echo $password | sudo -S apt-get install python3-pip -y #> /dev/null 2>&1
fi

if ! which "/usr/local/bin/scapy" > /dev/null; then
	printf "\nInstalling scapy on the DUT"
        echo $password | sudo -S pip3 install scapy > /dev/null 2>&1
fi
cd edsa
filename="EDSA_tag_param"
sed -i $filename -e "1s/.*/Interface    =$MGT_PORT/"

for i in $(seq 0 3);
do
	port_name="port_${i}_config"
        echo "$MGT_PORT (MGT_PORT) > Sending out 10 EDSA_frames with MAC_SRC=00:0$((i+1)):0$((i+1)):0$((i+1)):0$((i+1)):0$((i+1)) to the port $i of TS"

        sed -i $filename -e "3s/.*/MAC_SRC    =00:0$((i+1)):0$((i+1)):0$((i+1)):0$((i+1)):0$((i+1))/"
	#printf "\nDEBUG: DST_port=$(($(($block*4))+$i))\n"
        sed -i $filename -e "4s/.*/DST_port   =$(($(($block*4))+$i))/"

        echo $password | sudo -S python3 edsa.py -t $filename > /dev/null 2>&1
done

printf "Test finished. Stop capture in Test Station\n\n"

cd ..
}


function test_edsa_4_1(){

if ! which "/usr/bin/pip3" > /dev/null; then
        echo $password | sudo -S apt-get install python3-pip -y > /dev/null 2>&1
fi

if ! which "/usr/local/bin/scapy" > /dev/null; then
        pip3 install scapy > /dev/null 2>&1
fi

cd edsa
filename="EDSA_param"

for i in $(seq 0 3);
do

	port_name="port_${i}_config"

        echo "${!port_name} > Sending out 10 frames with MAC_SRC=00:0$((i+1)):0$((i+1)):0$((i+1)):0$((i+1)):0$((i+1)) to the PORT $i of TS"

        sed -i $filename -e "1s/.*/Interface   =${!port_name}/"
        sed -i $filename -e "2s/.*/MAC_dst    =00:0$((i+1)):0$((i+1)):0$((i+1)):0$((i+1)):0$((i+1))/"
        sed -i $filename -e "3s/.*/Position_N   =$i/"
        #cat $filename
        echo $password | sudo -S python3 edsa.py 4 $filename > /dev/null 2>&1

done

printf "Test finished. Stop capture in Test Station\n\n"

cd ..
}
